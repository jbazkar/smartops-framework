<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SmartOps Pulse Dashboard (v1 vs v2)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>

<!-- ðŸ”¹ Google Analytics (GA4) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VZY8YBQ2G"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-8VZY8YBQ2G');  // GA4 Measurement ID
</script>
<!-- ðŸ”¹ End GA4 -->  

<style>
  :root { --bg:#0b1020; --panel:#141a2e; --muted:#a8b0c3; --accent:#66d9e8; --ok:#29c17e; --warn:#f5b342; --err:#ef6b73; }
  *{box-sizing:border-box}
  body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--bg);color:#e6ecff}
  header{padding:24px 18px;border-bottom:1px solid #222a45; background:linear-gradient(180deg,#0d1530,#0b1020)}
  h1{margin:0;font-size:24px;font-weight:800;letter-spacing:.2px}
  h2{font-size:18px;margin:18px 0 8px}
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .card{grid-column:span 12;background:var(--panel);border:1px solid #232a46;border-radius:14px;padding:16px}
  @media(min-width:900px){
    .half{grid-column:span 6}
    .third{grid-column:span 4}
    .two{grid-column:span 8}
    .one{grid-column:span 4}
  }
  .muted{color:var(--muted);font-size:13px}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  .pill{padding:6px 10px;border-radius:999px;background:#0f1833;border:1px solid #26305a;color:#b9c0ff;font-size:12px}
  .kpi{display:flex;flex-direction:column;gap:6px;padding:12px;border-radius:12px;background:#101737;border:1px solid #1e2850}
  .kpi strong{font-size:22px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
  code{background:#0e1631;border:1px solid #26305a;border-radius:8px;padding:2px 6px}
  footer{padding:24px 18px;border-top:1px solid #222a45;color:#9fb0d5}
  .imgbox{display:flex;justify-content:center;padding:8px}
  .note{font-size:12px;color:#9fb0d5}
  table {width:100%;border-collapse:separate;border-spacing:0 8px;font-size:14px}
  th, td {padding:10px 12px;background:#0f1736}
  th{color:#bcd3ff;text-align:left;border-top-left-radius:10px;border-top-right-radius:10px}
  tr td:first-child{border-top-left-radius:10px;border-bottom-left-radius:10px}
  tr td:last-child{border-top-right-radius:10px;border-bottom-right-radius:10px}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>SmartOps Pulse Dashboard <span class="muted">(v1 reference vs v2 runtime)</span></h1>
    <div class="row muted">
      <span class="pill">Interactive</span>
      <span class="pill">Chart.js</span>
      <span class="pill">Loads CSV/PNG from repo at runtime</span>
    </div>
  </div>
</header>

<main class="wrap">
  <div class="grid">
    <section class="card third">
      <h2>Metrics â€” v2 (actual)</h2>
      <div class="kpi"><span class="muted">Accuracy</span><strong id="kpi-acc">â€”</strong></div>
      <div class="kpi"><span class="muted">False Positive Rate</span><strong id="kpi-fpr">â€”</strong></div>
      <div class="kpi"><span class="muted">Precision</span><strong id="kpi-prec">â€”</strong></div>
      <div class="kpi"><span class="muted">Recall</span><strong id="kpi-rec">â€”</strong></div>
      <p class="note">Source: <code>public/v2/banking_impact_summary_v2.csv</code></p>
    </section>

    <section class="card two">
      <h2>Alerts by Service (v2)</h2>
      <canvas id="chartAlerts"></canvas>
      <p class="note">Computed from <code>public/v2/banking_model_scores.csv</code> using adjusted thresholds.</p>
    </section>

    <section class="card two">
      <h2>Endpoint Alerts (v2)</h2>
      <canvas id="chartEndpoints"></canvas>
      <p class="note">From <code>public/v2/banking_endpoint_alerts_v2.csv</code>.</p>
    </section>

    <section class="card one">
      <h2>Confusion Matrix (v2)</h2>
      <div class="imgbox">
        <img id="cmImg" src="public/v2/banking_confusion_matrix_v2.png"
             alt="Confusion Matrix v2"
             style="max-width:100%;border-radius:10px;border:1px solid #27315c">
      </div>
      <p class="note">Synthetic ground truth used to estimate detection quality.</p>
    </section>

    <section class="card">
      <h2>Reference â€” v1 (published)</h2>
      <table id="tblV1">
        <thead><tr><th>Metric</th><th>Before</th><th>After</th><th>Î”</th></tr></thead>
        <tbody></tbody>
      </table>
      <p class="note">Source: <code>public/v1/banking_impact_summary.csv</code></p>
    </section>

    <!-- ðŸ‘ Views-by-date chart card -->
    <section class="card">
      <h2>SmartOps BFSI Page Views (Last 30 Days)</h2>
      <canvas id="viewsChart" height="180"></canvas>
      <p class="note">Served by AWS Lambda + DynamoDB (SmartOpsPageViewsDaily).</p>
    </section>
  </div>
</main>

<footer>
  <div class="wrap">
    <div class="muted">Â© 2025 SmartOps â€” AI-Driven Predictive Monitoring &amp; Anomaly Detection (Baskaran Jeyarajan)</div>

    <!-- ðŸ”¹ Visible page view counter -->
    <div style="text-align:center; margin-top:24px;">
      <span style="
        font-size:14px;
        font-weight:800;
        color:var(--muted);
        letter-spacing:0.3px;
        display:inline-flex;
        align-items:center;
        gap:8px;
      ">
        <!-- Eye icon -->
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none"
          stroke="var(--accent)" stroke-width="2"
          stroke-linecap="round" stroke-linejoin="round">
          <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
          <circle cx="12" cy="12" r="3"/>
        </svg>
        Page views: <span id="smartops-views">â€¦</span>
      </span>
    </div>
  </div>
</footer>

<script>
async function readCSV(path) {
  try {
    const res = await fetch(path);
    if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
    const text = await res.text();
    const [headerLine, ...lines] = text.trim().split(/\r?\n/);
    const headers = headerLine.split(",");
    return lines.map(l => {
      const cells = l.split(",");
      const o = {}; headers.forEach((h,i)=>o[h]=cells[i]); return o;
    });
  } catch (e) {
    console.warn('CSV load failed for', path, e);
    return [];
  }
}

function pct(v) { return /%$/.test(v) ? v : (parseFloat(v)*100).toFixed(0) + '%'; }

async function loadV2KPIs() {
  const rows = await readCSV('public/v2/banking_impact_summary_v2.csv');
  const m = Object.fromEntries(rows.map(r => [r.Metric, r['Banking v2 (Actual)']]));
  document.getElementById('kpi-acc').textContent  = m['Anomaly Detection Accuracy'] || 'â€”';
  document.getElementById('kpi-fpr').textContent  = m['False Positive Rate'] || 'â€”';
  document.getElementById('kpi-prec').textContent = m['Precision'] || 'â€”';
  document.getElementById('kpi-rec').textContent  = m['Recall'] || 'â€”';
}

async function alertsByServiceV2() {
  const rows = await readCSV('public/v2/banking_model_scores.csv');
  const alerts = {};
  for (const r of rows) {
    const ifs = parseFloat(r.score_iforest||0);
    const oc  = parseFloat(r.score_ocsvm||0);
    const ae  = parseFloat(r.score_autoenc||0);
    const a = (ifs>0.70 || oc>0.70 || ae>0.75) ? 1 : 0;
    const svc = r.service || 'service';
    alerts[svc] = (alerts[svc]||0) + a;
  }
  const labels = Object.keys(alerts);
  const data = labels.map(k => alerts[k]);
  const ctx = document.getElementById('chartAlerts');
  new Chart(ctx, {
    type: 'bar',
    data: { labels, datasets: [{ label: 'Alerts', data }] },
    options: {
      responsive: true,
      plugins: { legend: { display:false } },
      scales: { x: { ticks:{ color:'#cfe3ff' } }, y:{ ticks:{ color:'#cfe3ff' } } }
    }
  });
}

async function endpointAlertsV2() {
  const rows = await readCSV('public/v2/banking_endpoint_alerts_v2.csv');
  if (!rows.length) return;
  const services = [...new Set(rows.map(r=>r.service))];
  const endpoints = [...new Set(rows.map(r=>r.endpoint))];
  const datasets = endpoints.map((ep,i)=>{
    return {
      label: ep,
      data: services.map(svc=>{
        const row = rows.find(r=>r.service===svc && r.endpoint===ep);
        return row ? parseFloat(row.alert_adj||row.alerts||0) : 0;
      }),
      stack: 'stack1'
    };
  });
  const ctx = document.getElementById('chartEndpoints');
  new Chart(ctx, {
    type: 'bar',
    data: { labels: services, datasets },
    options: {
      responsive: true,
      plugins: { legend: { position:'bottom', labels:{ color:'#cfe3ff' } } },
      scales: { x: { stacked:true, ticks:{ color:'#cfe3ff' } }, y:{ stacked:true, ticks:{ color:'#cfe3ff' } } }
    }
  });
}

async function loadV1Table() {
  const rows = await readCSV('public/v1/banking_impact_summary.csv');
  const tbody = document.querySelector('#tblV1 tbody');
  if (!rows.length) { 
    tbody.innerHTML = '<tr><td colspan="4" class="muted">No v1 summary CSV found.</td></tr>'; 
    return; 
  }
  const delta = (a,b)=>{
    const n1 = parseFloat((a||'0').toString().replace('%',''));
    const n2 = parseFloat((b||'0').toString().replace('%',''));
    if (isNaN(n1)||isNaN(n2)) return 'â€”';
    const d = Math.round(n2-n1);
    return (d>=0?'+':'') + d + '%';
  };
  tbody.innerHTML = rows.map(r=>{
    const d = delta(r['Before AI Implementation'], r['After AI Implementation']);
    return `<tr>
      <td>${r.Metric}</td>
      <td>${r['Before AI Implementation']||'â€”'}</td>
      <td>${r['After AI Implementation']||'â€”'}</td>
      <td>${d}</td>
    </tr>`
  }).join('');
}

(async function init(){
  await loadV2KPIs();
  await alertsByServiceV2();
  await endpointAlertsV2();
  await loadV1Table();
})();
</script>

<!-- ðŸ”¹ Visible page view counter (uses Lambda summary: /views) -->
<script>
  (function () {
    const el = document.getElementById("smartops-views");
    if (!el) return;

    const pageKey = "bfsi_results";
    const endpointBase = "https://jmgf0i5809.execute-api.us-east-1.amazonaws.com/prod/views";
    const endpoint = endpointBase + "?page=" + encodeURIComponent(pageKey);

    fetch(endpoint)
      .then(res => res.json())
      .then(data => {
        console.log("SmartOps BFSI views API:", data);

        if (data && data.error) {
          console.error("BFSI views API error:", data.error);
          el.textContent = "0 (today: 0)";
          return;
        }

        const total = typeof data.views === "number" ? data.views : 0;
        const today = typeof data.today === "number" ? data.today : 0;

        el.textContent = `${total} (today: ${today})`;
      })
      .catch(err => {
        console.error("BFSI view counter error:", err);
        el.textContent = "0 (today: 0)";
      });
  })();
</script>

<!-- ðŸ”¹ Views-by-date chart (uses history: /views/history) -->
<script>
  (async function() {
    const canvas = document.getElementById("viewsChart");
    if (!canvas) return;

    const pageKey = "bfsi_results";
    const endpointBase = "https://jmgf0i5809.execute-api.us-east-1.amazonaws.com/prod/views/history";
    const endpoint = 
      endpointBase +
      "?page=" + encodeURIComponent(pageKey) +
      "&days=30&history=1";

    const res = await fetch(endpoint);
    const data = await res.json();
    console.log("BFSI views history API:", data);

    const labels = data.map(d => d.date);
    const values = data.map(d => d.views);

    new Chart(canvas, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: "Views (last 30 days)",
          data: values,
          borderColor: "#66d9e8",
          borderWidth: 2,
          tension: 0.3,
          fill: false
        }]
      },
      options: {
        plugins: {
          legend: { labels: { color: '#a8b0c3' } }
        },
        scales: {
          x: { ticks: { color: '#a8b0c3' } },
          y: { ticks: { color: '#a8b0c3' } }
        }
      }
    });
  })();
</script>

</body>
</html>
